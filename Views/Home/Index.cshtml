@model List<RMC_Donation.Models.ItemsWithUserViewModel>
@{
    ViewBag.Title = "Home Page";
}

<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include Fancybox CSS and JS from a CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>
</head>
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}

<!-- Main -->
<div id="main-wrapper">
    <main id="main-section">
        <!-- Your Item Grid Iteration -->
        @{
            int page = ViewBag.page;
            int pageSize = ViewBag.pageSize;
            int index = 0;
            int totalCount = ViewBag.TotalCount;
            int totalPages = (int)Math.Ceiling((double)totalCount / pageSize);
            int currentPage = page;
        }

        @{
            foreach (var itemWithUser in Model)
            {
                <article class="item-article">
                    <!-- Item Details -->
                    <div class="item-details">
                        <h3>Item Name: @itemWithUser.Item.name</h3>
                        <p><strong>Category: </strong> @itemWithUser.Item.catagory</p>
                        <strong>Details: </strong>
                        <p class="details-text" id="details-@index">
                            @itemWithUser.Item.details
                            <span class="read-more">Read More</span>
                        </p>
                    </div>

                    <!-- User Details -->
                    <div class="user-details">
                        <p><strong>User Name: </strong> @itemWithUser.User.fullname</p>
                        <p><strong>Email: </strong> <a href="mailto:@itemWithUser.User.email">@itemWithUser.User.email</a></p>
                    </div>

                    <!-- Images Container -->
                    <div class="item-images">
                        @if (!string.IsNullOrEmpty(itemWithUser.Item.imageurl1))
                        {
                            <a data-fancybox="image-gallery" href="@itemWithUser.Item.imageurl1" data-caption="Image 1" class="post-image-container">
                                <img src="@itemWithUser.Item.imageurl1" alt="Image 1" class="post-image" />
                            </a>
                        }
                        @if (!string.IsNullOrEmpty(itemWithUser.Item.imageurl2))
                        {
                            <a data-fancybox="image-gallery" href="@itemWithUser.Item.imageurl2" data-caption="Image 2" class="post-image-container">
                                <img src="@itemWithUser.Item.imageurl2" alt="Image 2" class="post-image" />
                            </a>
                        }
                        @if (!string.IsNullOrEmpty(itemWithUser.Item.imageurl3))
                        {
                            <a data-fancybox="image-gallery" href="@itemWithUser.Item.imageurl3" data-caption="Image 3" class="post-image-container">
                                <img src="@itemWithUser.Item.imageurl3" alt="Image 3" class="post-image" />
                            </a>
                        }
                        @if (!string.IsNullOrEmpty(itemWithUser.Item.imageurl4))
                        {
                            <a data-fancybox="image-gallery" href="@itemWithUser.Item.imageurl4" data-caption="Image 4" class="post-image-container">
                                <img src="@itemWithUser.Item.imageurl4" alt="Image 4" class="post-image" />
                            </a>
                        }
                    </div>
                </article>
                index++;
            }
        }

        <!-- Pagination controls -->
        <div class="pagination">
            @if (totalPages > 1)
            {
                if (currentPage > 1)
                {
                    <a href="@Url.Action("Index", new { page = 1 })">First</a>
                    <a href="@Url.Action("Index", new { page = currentPage - 1 })">&lt;</a>
                }

                for (int i = 1; i <= totalPages; i++)
                {
                    <a href="@Url.Action("Index", new { page = i })" @(i == currentPage ? "class=active" : "")>@i</a>
                }

                if (currentPage < totalPages)
                {
                    <a href="@Url.Action("Index", new { page = currentPage + 1 })">&gt;</a>
                    <a href="@Url.Action("Index", new { page = totalPages })">Last</a>
                }
            }
        </div>
    </main>
</div>


@section scripts{
    <script>
        jQuery(document).ready(function ($) {
            $("[data-fancybox]").fancybox({
                buttons: ["zoom", "slideShow", "thumbs", "close"]
            });
        });

        $(document).ready(function () {
            $(".details-text").each(function () {
                var $text = $(this);
                var $readMore = $text.find(".read-more");
                var originalHeight = $text.innerHeight();
                // Check if the text needs to be truncated
                if ($text[0].scrollHeight > originalHeight) {
                    $readMore.show();
                    $readMore.click(function () {
                        $text.toggleClass("expanded");
                        if ($text.hasClass("expanded")) {
                            $text.css("-webkit-line-clamp", "initial"); // Remove line clamp
                            $readMore.text("Read Less");
                        } else {
                            $text.css("-webkit-line-clamp", "2"); // Reapply 2-line clamp
                            $readMore.text("Read More");
                        }
                    });
                }
            });
        });

    </script>
}